name: Builds

on: [push, pull_request]

jobs:
  build:
    name: Build on MacOS
    runs-on: macos-13

    steps:
      - uses: actions/checkout@v4
        with:
          path: MITK

      - name: Install tools
        run: brew install tree doxygen

      - name: Install Qt
        uses: jurplel/install-qt-action@v4
        with:
          aqtversion: '==3.1.*'
          version: 6.7.3
          host: mac
          target: desktop
          arch: clang_64
          modules: 'qt3d qtcharts qtconnectivity qtdatavis3d qtgraphs qtgrpc qthttpserver qtimageformats qtlanguageserver qtlocation qtlottie qtmultimedia qtnetworkauth qtpdf qtpositioning qtquick3dphysics qtquickeffectmaker qtremoteobjects qtscxml qtsensors qtserialbus qtserialport qtspeech qtvirtualkeyboard qtwebchannel qtwebengine qtwebsockets qtwebview qt5compat qtquick3d qtquicktimeline qtshadertools'
          cache: 'true'

      - name: Build MITK
        env:
          MACOSX_DEPLOYMENT_TARGET: 10.14
        run: |
          mkdir MITK-superbuild
          cd MITK-superbuild
          cmake -DCMAKE_BUILD_TYPE=Release ../MITK
          make -j4
          make package

      - name: List build
        run: tree MITK-build/bin
      
      - name: Upload disk image
        uses: actions/upload-artifact@v4
        with:
          name: image-${{ matrix.os }}
          path: MITK-build/bin/*.dmg
